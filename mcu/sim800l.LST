C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE SIM800L
OBJECT MODULE PLACED IN sim800l.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE sim800l.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #include <string.h>
   3          
   4          
   5          #define START       0x00
   6          #define AIRPLANE    0x01
   7          #define MOBILE      0x02
   8          #define REARY       0x03
   9          #define ONLINE      0x04
  10          #define SIM         0x05
  11          #define REG         0x06
  12          #define SIGNAL      0x07
  13          #define SHUT        0x08
  14          #define NEWSMS      0x09
  15          #define APN         0x10
  16          #define GPRS        0x11
  17          #define IP          0x12
  18          #define SERVER      0x13 
  19          
  20          #define RX_LEN      60
  21          #define TX_LEN      400 
  22          
  23          char    code    CMD_AIRPLANE[]    =   "AT+CFUN=0\r\n";
  24          char    code    CMD_MOBILE[]      =   "AT+CFUN=1\r\n";
  25          char    code    CMD_AT[]          =   "AT\r\n";
  26          char    code    CMD_SIM[]         =   "AT+CPIN?\r\n";
  27          char    code    CMD_REG[]         =   "AT+CREG?\r\n";
  28          char    code    CMD_SIGNAL[]      =   "AT+CSQ\r\n";
  29          char    code    CMD_SHUT[]        =   "AT+CIPSHUT\r\n";
  30          char    code    CMD_SHUTGPRS[]    =   "AT+CGATT=0\r\n";
  31          char    code    CMD_CKSMS[]       =   "AT+CPMS?\r\n";
  32          char    code    CMD_GTSMS[]       =   "AT+CMGR=";
  33          char    code    CMD_DLSMS[]       =   "AT+CMGD=";
  34          char    code    CMD_APN[]         =   "AT+CSTT=\"CMNET\"\r\n";
  35          char    code    CMD_GPRS[]        =   "AT+CIICR\r\n";
  36          char    code    CMD_IP[]          =   "AT+CIFSR\r\n";
  37          char    code    CMD_SERVER[]      =   "AT+CIPSTART=\"TCP\",\"193.112.94.54\",\"9001\"\r\n";
  38          char    code    CMD_SEND[]        =   "AT+CIPSEND\r\n";
  39          
  40          
  41          unsigned    char    data    RX_BUFFER[RX_LEN]   =   {0};
  42          unsigned    int     data    RX_INDEX            =   0; 
  43          unsigned    char    xdata   TX_BUFFER[TX_LEN]   =   {0};
  44          unsigned    int     data    TX_INDEX            =   0; 
  45          unsigned    int     CHANGE_BUFFER               =   0;
  46          unsigned    char    STATUS;
  47          unsigned    char    SMS_CNT[2] = {0};
  48          int i;
  49          
  50          void RUN();
  51          void SEND_BYTE(unsigned char c);
  52          void SEND_STRING(unsigned char *p);
  53          void CLEAN_RX_BUFFER();
  54          void CLEAN_TX_BUFFER();
  55          void Delay1ms(unsigned int i);
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 2   

  56          void SERIAL();
  57          void UART();
  58          void DEBUG();
  59          
  60          
  61          
  62          void main()
  63          {
  64   1          P0 = 0X00;
  65   1          STATUS = START;
  66   1          while(1)
  67   1          {
  68   2             RUN(); 
  69   2          }
  70   1      }
  71          
  72          
  73          void RUN()
  74          {
  75   1          if(STATUS == START)
  76   1          {
  77   2              //  INIT();             初始化串口等设置
  78   2              //  YES :   READY 
  79   2              //  NO  :
  80   2      
  81   2              UART();
  82   2              STATUS = REARY;
  83   2          }
  84   1      
  85   1          else if(STATUS == AIRPLANE)
  86   1          {
  87   2              //  "AT+CFUN=0" ;        开启飞行模式
  88   2              //  YES :   MOBILE 
  89   2              //  NO  :   硬件重启
  90   2              unsigned char *p;
  91   2      
  92   2              CLEAN_RX_BUFFER();
  93   2              Delay1ms(30);
  94   2      
  95   2              SEND_STRING(CMD_AIRPLANE);
  96   2              Delay1ms(100);  // 3s
  97   2      
  98   2              p = strstr(RX_BUFFER,"OK");
  99   2              if(p !=NULL)
 100   2              {
 101   3                  STATUS = MOBILE;
 102   3              }        
 103   2          }
 104   1      
 105   1          else if(STATUS == MOBILE)
 106   1          {
 107   2              //  "AT+CFUN=1" ;       关闭飞行模式   
 108   2              //  YES :   NEWSMS 
 109   2              //  NO  :
 110   2              unsigned char *p;
 111   2      
 112   2              CLEAN_RX_BUFFER();
 113   2              Delay1ms(30);
 114   2      
 115   2              SEND_STRING(CMD_MOBILE);
 116   2              Delay1ms(30);   // 0.5s
 117   2      
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 3   

 118   2              p = strstr(RX_BUFFER,"OK");   // "+CPIN: READY"
 119   2              if(p != NULL)
 120   2              {
 121   3                  STATUS = REARY;
 122   3              }
 123   2          }
 124   1      
 125   1          else if(STATUS == REARY)
 126   1          {
 127   2              //  "AT" ;              尝试和模块通信
 128   2              //  YES :   ONLINE 
 129   2              //  NO  :
 130   2              unsigned char *p;
 131   2      
 132   2              CLEAN_RX_BUFFER();
 133   2              Delay1ms(30);
 134   2      
 135   2              SEND_STRING(CMD_AT);
 136   2              Delay1ms(30);
 137   2      
 138   2              p = strstr(RX_BUFFER,"OK");
 139   2              if(p != NULL)
 140   2              {
 141   3                  CLEAN_RX_BUFFER();
 142   3                  STATUS = ONLINE;
 143   3              }
 144   2          }
 145   1      
 146   1          else if(STATUS == ONLINE)
 147   1          {
 148   2              //  "AT+CPIN?";         检查SIM状态
 149   2              //  YES :   SIM 
 150   2              //  NO  :   i > 20  AIRPLANE
 151   2              unsigned char *p;
 152   2      
 153   2              CLEAN_RX_BUFFER();
 154   2              Delay1ms(30);
 155   2      
 156   2              if(i >= 20)
 157   2              {
 158   3                  STATUS = AIRPLANE;
 159   3                  i=0;
 160   3              }
 161   2              else
 162   2              {
 163   3                  SEND_STRING(CMD_SIM);
 164   3                  Delay1ms(30);   // 1s
 165   3      
 166   3                  p = strstr(RX_BUFFER,"+CPIN: READY");
 167   3                  if(p != NULL)
 168   3                  {
 169   4                      STATUS = SIM;
 170   4                      i=0;
 171   4                  }
 172   3                  else
 173   3                  {
 174   4                      i++;
 175   4                  }
 176   3              }
 177   2          }
 178   1      
 179   1          else if(STATUS == SIM)
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 4   

 180   1          {
 181   2              //  "AT+CREG"           检查是否注册到家庭网络(0,1)或漫游网络(0,5)
 182   2              //  YES :   REG 
 183   2              //  NO  :   i > 50  AIRPLANE 
 184   2              unsigned char *p;
 185   2      
 186   2              CLEAN_RX_BUFFER();
 187   2              Delay1ms(30);
 188   2      
 189   2              if(i > 50)
 190   2              {
 191   3                  STATUS = AIRPLANE;
 192   3                  i=0;
 193   3              }
 194   2              else
 195   2              { 
 196   3                  SEND_STRING(CMD_REG);
 197   3                  Delay1ms(30);   // 0.5s
 198   3      
 199   3                  p = strstr(RX_BUFFER,"1");
 200   3                  if(p != NULL)
 201   3                  {
 202   4                      STATUS = REG;
 203   4                      i=0;
 204   4                  }
 205   3                  else
 206   3                  {
 207   4                      p = strstr(RX_BUFFER,"5");
 208   4                      if(p != NULL)
 209   4                      {
 210   5                          STATUS = REG;
 211   5                          i=0;
 212   5                      }
 213   4                      else
 214   4                      {
 215   5                          i++;
 216   5                      }
 217   4                  }
 218   3              }
 219   2          }
 220   1      
 221   1          else if(STATUS == REG)
 222   1          {
 223   2              //  "AT+CSQ"            检查网络质量(0-31)
 224   2              //  YES :   SIGNAL 
 225   2              //  NO  :   i > 50  AIRPLANE
 226   2              unsigned char *p;
 227   2      
 228   2              CLEAN_RX_BUFFER();
 229   2              Delay1ms(30);
 230   2      
 231   2              if(i > 50)
 232   2              {
 233   3                  STATUS = AIRPLANE;
 234   3                  i=0;
 235   3              }
 236   2              else
 237   2              {
 238   3                  SEND_STRING(CMD_SIGNAL);
 239   3                  Delay1ms(30);
 240   3      
 241   3                  // if(RX_BUFFER[6] > '0')
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 5   

 242   3                  // {
 243   3      
 244   3                  //     CLEAN_RX_BUFFER();
 245   3                  //     STATUS = SIGNAL;
 246   3                  //     i=0;
 247   3                  // }
 248   3                  // else if(RX_BUFFER[7] > '0')
 249   3                  // {
 250   3      
 251   3                  //     CLEAN_RX_BUFFER();
 252   3                  //     STATUS = SIGNAL;
 253   3                  //     i=0;
 254   3                  // }
 255   3                  // else
 256   3                  // {
 257   3                  //     i++;
 258   3                  //     CLEAN_RX_BUFFER();
 259   3                  // }
 260   3      
 261   3                  p = strstr(RX_BUFFER,"OK");
 262   3                  if(p != NULL)
 263   3                  {
 264   4                      STATUS = SIGNAL;
 265   4                  }
 266   3                  else
 267   3                  {
 268   4                      i++;
 269   4                  }
 270   3              }
 271   2              
 272   2              // p = strstr(RX_BUFFER,"OK");
 273   2              // if(p != NULL)
 274   2              // {
 275   2              //     STATUS = SIGNAL;
 276   2              //     CLEAN_RX_BUFFER();
 277   2              // }
 278   2          }
 279   1      
 280   1          else if(STATUS == SIGNAL)
 281   1          {
 282   2              //  "AT+CMPS?"           检查有没有新短信
 283   2              //  YES :   NEWSMS 
 284   2              //  NO  :   i > 20  READY
 285   2              unsigned char *p;
 286   2              unsigned char *g;
 287   2              int k;
 288   2      
 289   2              CLEAN_RX_BUFFER();
 290   2              Delay1ms(30);
 291   2      
 292   2              P0 = 0X80;
 293   2      
 294   2              if( i >= 50)
 295   2              {
 296   3                  STATUS = REARY;
 297   3                  i=0;
 298   3              }
 299   2              else
 300   2              {
 301   3                  SEND_STRING(CMD_CKSMS);
 302   3                  Delay1ms(30);
 303   3      
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 6   

 304   3                  g = strstr(RX_BUFFER,"SM_P");
 305   3                  if(g != NULL)
 306   3                  {
 307   4                      g +=6;
 308   4                      SMS_CNT[0] = *g++;
 309   4                      SMS_CNT[1]  = *g;
 310   4      
 311   4                      if(SMS_CNT[1] == ',')
 312   4                      {
 313   5                          SMS_CNT[1] = '\0';
 314   5                      }
 315   4                      // if(*g >= '0' && *g <= '9');
 316   4                      // {
 317   4                      //     SMS_CNT[1]  =  *g;
 318   4                      // }
 319   4                  }
 320   3                  if(SMS_CNT[0] > '0')
 321   3                  {
 322   4                      if(SMS_CNT[0] <= '9')
 323   4                      {
 324   5      
 325   5                          // SEND_BYTE(SMS_CNT[0]);
 326   5                          // SEND_BYTE(SMS_CNT[0]);
 327   5                          // SEND_BYTE(SMS_CNT[0]);
 328   5                          // SEND_BYTE(SMS_CNT[0]);
 329   5                          // SEND_BYTE(SMS_CNT[0]);
 330   5                          // SEND_BYTE(SMS_CNT[1]);
 331   5                          // SEND_BYTE(SMS_CNT[1]);
 332   5                          // SEND_BYTE(SMS_CNT[1]);
 333   5                          // SEND_BYTE(SMS_CNT[1]);
 334   5                          // SEND_BYTE(SMS_CNT[1]);
 335   5                      
 336   5      
 337   5                          CHANGE_BUFFER = 1;
 338   5      
 339   5                          TX_INDEX = 0;
 340   5      
 341   5                          SEND_STRING(CMD_GTSMS);
 342   5      
 343   5                          for(k = 0; k < strlen(SMS_CNT); k++)
 344   5                              {
 345   6                                  SEND_BYTE(SMS_CNT[k]);
 346   6                              }
 347   5                          
 348   5                          // 遍历短信，耗性能
 349   5                      
 350   5                          // for(l = 50;l > 0; l--)
 351   5                          // {
 352   5                          //     SEND_STRING(CMD_GTSMS);
 353   5                          //     SEND_BYTE(l);
 354   5                          //     SEND_BYTE(0X0D);
 355   5                          //     SEND_BYTE(0X0A);
 356   5                          //     if(strlen(TX_BUFFER) >= 36)
 357   5                          //     {
 358   5                          //         SMS_INDEX = l;
 359   5                          //         break;
 360   5                          //     }
 361   5                          // }
 362   5                          
 363   5                          SEND_BYTE(0X0D);
 364   5                          SEND_BYTE(0X0A);
 365   5                          
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 7   

 366   5                          Delay1ms(50);
 367   5                          CHANGE_BUFFER = 0;
 368   5                          
 369   5      
 370   5                          p = strstr(TX_BUFFER,"+CM"); // "+CMGR:"
 371   5                          if(p != NULL)
 372   5                          {
 373   6                              // strcpy(TX_BUFFER,RX_BUFFER);
 374   6                              // SEND_STRING(RX_BUFFER);
 375   6                              // Delay1ms(5);
 376   6                              // CLEAN_RX_BUFFER();
 377   6                              // SEND_BYTE(0X31);
 378   6                              // SEND_BYTE(0X31);
 379   6                              // SEND_BYTE(0X31);
 380   6                              // SEND_BYTE(0X31);
 381   6                              // SEND_BYTE(0X31);
 382   6                              // DEBUG();
 383   6                              // SEND_STRING(TX_BUFFER);
 384   6      
 385   6                              TX_INDEX = 0;   // 重置索引，保证发出去的数据序列正确
 386   6                              STATUS = NEWSMS;
 387   6                              i=0;
 388   6                          }
 389   5                          else
 390   5                          {
 391   6                              i++;
 392   6                          }
 393   5                      }      
 394   4                  }
 395   3                  else
 396   3                  {
 397   4                      i++;
 398   4                  }
 399   3              }
 400   2              P0 = 0X00;
 401   2          }
 402   1      
 403   1          else if(STATUS == SHUT)
 404   1          {
 405   2              //  "AT+CIPSHUT"             关闭移动场景
 406   2              //  YES :   SIGNAL 
 407   2              //  NO  :   AIRPLANE
 408   2              unsigned char *p;
 409   2              
 410   2              // SEND_STRING(CMD_SHUTGPRS);
 411   2              // Delay1ms(5);
 412   2              CLEAN_RX_BUFFER();
 413   2              Delay1ms(30);
 414   2      
 415   2              SEND_STRING(CMD_SHUT);
 416   2              Delay1ms(30);
 417   2      
 418   2              p = strstr(RX_BUFFER,"SHUT OK");
 419   2              if(p != NULL)
 420   2              {
 421   3                  STATUS = SIGNAL;
 422   3              }
 423   2              else
 424   2              {
 425   3                  STATUS = AIRPLANE;
 426   3              }      
 427   2          }
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 8   

 428   1      
 429   1          else if(STATUS == NEWSMS)
 430   1          {
 431   2              //  "AT+CSTT=\"CMNET\""         设置CMNET
 432   2              //  YES :   APN 
 433   2              //  NO  :   SHUT
 434   2              unsigned char *p;
 435   2      
 436   2              CLEAN_RX_BUFFER();
 437   2              Delay1ms(30);
 438   2      
 439   2              SEND_STRING(CMD_APN);
 440   2              Delay1ms(50);
 441   2      
 442   2              p = strstr(RX_BUFFER,"OK");
 443   2              if(p != NULL)
 444   2              {
 445   3                  STATUS = APN;
 446   3              }
 447   2              else
 448   2              {
 449   3                  STATUS = SHUT;
 450   3              }       
 451   2          }
 452   1      
 453   1          else if(STATUS == APN)
 454   1          {
 455   2              //  "AT+CIICR"                  开启GPRS
 456   2              //  YES :   GPRS 
 457   2              //  NO  :   SHUT
 458   2              unsigned char *p;
 459   2      
 460   2              CLEAN_RX_BUFFER();
 461   2              Delay1ms(30);
 462   2      
 463   2              SEND_STRING(CMD_GPRS);
 464   2              Delay1ms(50);
 465   2      
 466   2              p = strstr(RX_BUFFER,"OK");
 467   2              if(p != NULL)
 468   2              {
 469   3                  STATUS = GPRS;
 470   3              }
 471   2              else
 472   2              {
 473   3                  STATUS = SHUT;
 474   3              }        
 475   2          }
 476   1      
 477   1          else if(STATUS == GPRS)
 478   1          {
 479   2              //  "AT+CIFSR"                  查询获取的IP
 480   2              //  YES :   IP 
 481   2              //  NO  :   SHUT
 482   2              unsigned char *p;
 483   2      
 484   2              CLEAN_RX_BUFFER();
 485   2              Delay1ms(30);
 486   2      
 487   2              SEND_STRING(CMD_IP);
 488   2              Delay1ms(30);
 489   2      
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 9   

 490   2              p = strstr(RX_BUFFER,".");
 491   2              if(p != NULL)
 492   2              {
 493   3                  STATUS = IP;
 494   3              }
 495   2          }
 496   1      
 497   1          else if(STATUS == IP)
 498   1          {
 499   2              //  "AT+CIPSTART=\"TCP\",\"8.8.8.8\",\"443\""       连接远程服务器 
 500   2              //  YES :   SERVER 
 501   2              //  NO  :   SHUT
 502   2              unsigned char *p;
 503   2      
 504   2              CLEAN_RX_BUFFER();
 505   2              Delay1ms(30);
 506   2      
 507   2              SEND_STRING(CMD_SERVER);
 508   2              Delay1ms(50);
 509   2      
 510   2              p = strstr(RX_BUFFER,"CONNECT OK");
 511   2              if(p != NULL)
 512   2              {
 513   3                  STATUS = SERVER;
 514   3              }
 515   2              else
 516   2              {
 517   3                  STATUS = SHUT;
 518   3              }
 519   2          }
 520   1      
 521   1          else if(STATUS == SERVER)
 522   1          {
 523   2              //  "AT+CIPSEND"                发送短信 
 524   2              //  YES :   SIGNAL 
 525   2              //  NO  :   SERVER  i > 2 SHUT
 526   2              unsigned char *p;
 527   2              unsigned char *g;
 528   2              int j;
 529   2              int k;
 530   2      
 531   2              CLEAN_RX_BUFFER();
 532   2              Delay1ms(30);
 533   2      
 534   2              if(i > 2)
 535   2              {
 536   3                  STATUS = SHUT;
 537   3                  i=0;
 538   3              }
 539   2              else
 540   2              {
 541   3                  SEND_STRING(CMD_SEND);
 542   3                  Delay1ms(30);
 543   3      
 544   3                  p = strstr(RX_BUFFER,">");
 545   3                  if(p != NULL)
 546   3                  {
 547   4                      CLEAN_RX_BUFFER();
 548   4                      Delay1ms(30);
 549   4      
 550   4                      for(j = 0;j < strlen(TX_BUFFER); j++)
 551   4                      {
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 10  

 552   5                          SEND_BYTE(TX_BUFFER[j]);
 553   5                      }
 554   4                      SEND_BYTE(0X1A);
 555   4                      Delay1ms(30); //延迟太低就收不到反馈
 556   4      
 557   4                      g = strstr(RX_BUFFER,"SEND OK");  //  "SEND OK"
 558   4                      if(g != NULL)
 559   4                      {
 560   5      
 561   5                          SEND_STRING(CMD_DLSMS);
 562   5      
 563   5                          for(k = 0; k < strlen(SMS_CNT); k++)
 564   5                          {
 565   6                              SEND_BYTE(SMS_CNT[k]);
 566   6                          }
 567   5      
 568   5                          SEND_BYTE(0X0D);
 569   5                          SEND_BYTE(0X0A);
 570   5      
 571   5                          CLEAN_TX_BUFFER();
 572   5                          STATUS = SHUT;
 573   5                          i=0;
 574   5      
 575   5                      }
 576   4                      else
 577   4                      {
 578   5                          i++;
 579   5                      }
 580   4                      DEBUG();            
 581   4                  }
 582   3                  else
 583   3                  {
 584   4                      i++;
 585   4                  }            
 586   3              }        
 587   2          }
 588   1      }
 589          
 590          //  1.发送 AT 和模块通信
 591          //  2.发送 AT+CPIN? 检测SIM卡状态
 592          //  3.发送 AT+CREG? 查询入网情况
 593          //  3.发送 AT+CSQ 查询信号质量
 594          //  4.发送 AT+CGATT? 查询GPRS附着情况
 595          
 596          
 597          //  5.发送 AT+CIPSHUT 关闭移动场景
 598          //  6.发送 AT+CSTT="CMNET" 设置APN
 599          //  7.发送 AT+CIICR 激活移动场景
 600          //  8.发送 AT+CIFSR 查询IP地址
 601          //  9.发送 AT+CIPSTART="TCP","193.112.94.54","9001" 连接服务器
 602          // 10.发送 AT+CIPSEND 收到'>'后，发送数据
 603          // 11.发送 AT+CIPCLOSE 关闭连接
 604          // 12.发送 AT+CIPSHUT 关闭移动场景
 605          
 606          
 607          void SEND_BYTE(unsigned char c)
 608          {
 609   1          while(!TI);
 610   1          TI = 0;
 611   1          SBUF = c;
 612   1      }
 613          
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 11  

 614          
 615          void SEND_STRING(unsigned char *p)
 616          {
 617   1          while(*p != '\0')
 618   1          {
 619   2              SEND_BYTE(*p++);
 620   2          }
 621   1      }
 622          
 623          void CLEAN_RX_BUFFER()
 624          {
 625   1          memset(RX_BUFFER,0,sizeof(RX_BUFFER));
 626   1          RX_INDEX = 0;
 627   1      }
 628          
 629          void CLEAN_TX_BUFFER()
 630          {
 631   1          memset(TX_BUFFER,0,sizeof(TX_BUFFER));
 632   1          TX_INDEX = 0;
 633   1      }
 634          
 635          //  50  感觉是1s
 636          //  100 感觉是3s
 637          //  200 感觉是7s
 638          //  500 感觉是17s
 639          void Delay1ms(unsigned int i)
 640          {
 641   1              unsigned int j;
 642   1              while(i--)
 643   1              {
 644   2                      for(j = 0; j < 125; j++);
 645   2              }
 646   1      }
 647          
 648          void SERIAL() interrupt 4
 649          {
 650   1          if(RI)
 651   1          {
 652   2              if(!CHANGE_BUFFER)
 653   2              {
 654   3                  RI = 0;
 655   3                  RX_BUFFER[RX_INDEX++] = SBUF;
 656   3      
 657   3                  if(RX_INDEX >= RX_LEN - 1)
 658   3                  {
 659   4                      RX_INDEX = 0;
 660   4                  }
 661   3              }
 662   2              else
 663   2              {
 664   3                  RI = 0;
 665   3                  TX_BUFFER[TX_INDEX++] = SBUF;
 666   3      
 667   3                  if(TX_INDEX >= TX_LEN - 1)
 668   3                  {
 669   4                      TX_INDEX = 0;
 670   4                  }
 671   3              }
 672   2              
 673   2          }
 674   1      }
 675          
C51 COMPILER V9.01   SIM800L                                                               04/05/2019 13:19:46 PAGE 12  

 676          void UART()
 677          {
 678   1          SCON = 0X52;
 679   1          PCON = 0X80;
 680   1          TMOD = 0X20;
 681   1          TH1  = 0XFD;
 682   1          TR1  = 0XFD;
 683   1      
 684   1          ES   = 1;
 685   1          EA   = 1;
 686   1          TR1  = 1;
 687   1      }
 688          
 689          void DEBUG()
 690          {
 691   1          Delay1ms(100);
 692   1      
 693   1          SEND_BYTE('D');
 694   1          SEND_BYTE('E');
 695   1          SEND_BYTE('B');
 696   1          SEND_BYTE('U');
 697   1          SEND_BYTE('G');
 698   1          SEND_BYTE(':');
 699   1      
 700   1          SEND_STRING(RX_BUFFER);
 701   1      
 702   1          SEND_BYTE(':');
 703   1          SEND_BYTE('D');
 704   1          SEND_BYTE('E');
 705   1          SEND_BYTE('B');
 706   1          SEND_BYTE('U');
 707   1          SEND_BYTE('G');
 708   1      
 709   1          Delay1ms(100);
 710   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1702    ----
   CONSTANT SIZE    =    271    ----
   XDATA SIZE       =    400    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     71      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
